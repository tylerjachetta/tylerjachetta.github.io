<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <title>Cards and Conditionals</title>
    
    <!-- step 1: load jQuery library -->
	<script src="jquery-1.12.0.min.js"></script>
    
    <!-- step 2: load playing cards project files (js + css) -->
	<script src="playingCards.js"></script>
	<script src="playingCards.ui.js"></script>
    <link rel="stylesheet" type="text/css" href="playingCards.ui.css">
</head>
<body style = "background-color: #006400; font-family: Arial; color: white;">
	<h1 id="balance"></h1>
	<!-- step 3: provide html elements for UI -->
	<div id="controls">
		<button type="button" onclick="startRound();" id="startButton">
			Start!
		</button>
		<button type="button" onclick="hit();" id="hitButton" style="visibility:hidden;">
			Hit
		</button>
		<button type="button" onclick="stay();" id="stayButton" style="visibility:hidden;">
			Stay
		</button>
		<button type="button" onclick="playAgain();" id="restartButton" style="visibility:hidden;">
			Play again
		</button>
	</div>
	
	<h4 id="scoreboard">
	</h4>
	
	<div id="cardtray">
	</div>
	<h4 id="scoreboard2" style="margin-top:150px;">
	</h4>
	
	<div id="cardtray2" >
	</div>
	<div id="cardtray3" >
	</div>
	<h1 id="header" style="margin-top:150px"></h1>


	<script>
		// initalize score
		var score = 0, score2 = 0;
		var balance = 100, balanceModifier = 0;
		
		// create card deck object
 	   	var cardDeck = $("#cardtray").playingCards();
    
    	// shuffle card objects
  		cardDeck.shuffle();

		function startRound() 
		{
			document.getElementById('startButton').style.display = 'none'; //Makes game interface visibile
			document.getElementById('hitButton').style.visibility = 'visible'; 
			document.getElementById('stayButton').style.visibility = 'visible'; 
			document.getElementById('restartButton').style.visibility = 'hidden'; 
			document.getElementById('scoreboard2').style.visibility = 'hidden'; 
			document.getElementById('cardtray3').style.display = 'none'; 
			document.getElementById('cardtray2').style.display = 'inline'; 
			bet();

			cardDeck = $("#cardtray").playingCards();
            cardDeck.shuffle();

			addCardPlayerDeck();//Adds two cards to player's and dealer's deck
			addCardPlayerDeck();
			addCardDealerDeck();
			addCardDealerDeck();
		}

		function bet()
		{
			if(balance < 10)
			{
				$('#balance').html("You ran out of money!");

				document.getElementById('startButton').style.display = 'none'; 
				document.getElementById('hitButton').style.display = 'none'; 
				document.getElementById('stayButton').style.display = 'none';  
				document.getElementById('restartButton').style.display = 'none'; 
				document.getElementById('scoreboard').style.display = 'none'; 
				document.getElementById('scoreboard2').style.display = 'none'; 
				document.getElementById('cardtray3').style.display = 'none'; 
				document.getElementById('cardtray2').style.display = 'none'; 
				document.getElementById('cardtray').style.display = 'none'; 
			}
			else
			{		
				$('#balance').html("Your balance is currenty $ " + balance + ".");
				console.log(balance);
			}
			
		}
		
		function addCardPlayerDeck()
		{
			var newCard = cardDeck.draw();
			getCardValue (newCard);
			$('#scoreboard').html( score );
			var markup = newCard.getHTML();
			$('#cardtray').append( markup );
		}

		function addCardDealerDeck()
		{
			var newCard = cardDeck.draw();
			getCardValueD (newCard);
			$('#scoreboard2').html( score2 );
			var markup = newCard.getHTML();
			$('#cardtray2').prepend('<img id="backcard" src="img/back.png" />')
			$('#cardtray3').append( markup );
		
		}

		function getCardValue (card)
		{
			if ( ( card.rank == 'Q' ) || (card.rank == 'K') || (card.rank == 'J'))
			{
				score += 10; // score++;
				
			} 
			else if ( card.rank == 'A' )
			{

				if(score+11 > 21)
				{
					score++;
				}
				else 
				{
					score += 11;
				}
			}
			else
			{
				score += Number(card.rank); 
				//Uses existing property within the object to calculate score for # cards
			}

			if(score > 21)
			{
				loss();

			}
			
		}

		function getCardValueD (card)
		{
			if ( ( card.rank == 'Q' ) || (card.rank == 'K') || (card.rank == 'J'))
			{
				score2 += 10; 
				
			} 
			else if ( card.rank == 'A' )
			{
				if(score2+11 > 21)
				{
					score2++;
				}
				else 
				{
					score2 += 11;
				}
			}
			else
			{
				score2 += Number(card.rank); 
			}

			if(score2 > 21)
			{
				win();
			}
		}

		function hit ()
		{
			addCardPlayerDeck();

			hitD();
		}

		function hitD ()
		{
			var chance = Math.floor((Math.random() * 10) + 1);
			
			if(score2 <= 10)
			{
				addCardDealerDeck();
			}
			else if (score2 < 17)
			{
				var chance = Math.floor((Math.random() * 10) + 1);
				console.log(chance);

				if(chance < 7)
				{
					addCardDealerDeck();
				}
			}
		
		}
		
		function restart()
		{
			console.log(balanceModifier);
			balance = balance + balanceModifier;
			document.getElementById('stayButton').style.display = 'none'; 
			document.getElementById('hitButton').style.display = 'none'; 
			document.getElementById('restartButton').style.visibility = 'visible'; 
		}

		function stay()
		{	

			document.getElementById('cardtray3').style.display = 'inline'; 
			
			if (score2 > 21 && score < 22)
			{
				win();
			} 
			else if(score > score2 && score < 22)
			{
				hitD();
				win();
			}
			else
			{
				loss();
			}
		}

		function loss()
		{
			balanceModifier = -10;
			$('#header').html("You lose!" );
			appearCards();
			document.getElementById('scoreboard2').style.visibility = 'visible'; 

			restart();
		}

		function win()
		{
			balanceModifier = 10;
			$('#header').html("You Won!" );
			appearCards();
			document.getElementById('scoreboard2').style.visibility = 'visible'; 
			restart();
		}

		function playAgain()
		{
			score = 0;
			score2 = 0;
			$('#cardtray, #cardtray2, #cardtray3, #scoreboard, #scoreboard2, #header').empty();

			document.getElementById('stayButton').style.display = 'inline'; 
			document.getElementById('hitButton').style.display = 'inline'; 

			startRound();
		}

		function appearCards()
		{
			document.getElementById('cardtray3').style.display = 'inline'; 
			document.getElementById('cardtray2').style.display = 'none'; 
		}
    </script>
  </div>
</body>
</html>
