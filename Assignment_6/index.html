<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Best places to eat in Santa Rosa</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <header>
        <h1>Best places to eat in Santa Rosa</h1>
    </header>

	<div id="map-container">
	</div>
	


	<!-- Load the Google Maps API library -->
	<script type="text/javascript" src="https://maps.google.com/maps/api/js?libraries=geometry&key=AIzaSyANwuVysbRlA9s-4mgKvkdxL0ODklj-Hhg"></script>
	
	<!-- Custom code to create map and marker for user's geolocation -->
	<script>
	// define variables map1 & marker1 outside function wrapper 
	// to ensure they are globally available to all code in page
	var map1, marker1;
	var line1;
	var line2;
	var line3;

	// define fixed "destination" point for calculating distances
	var destCoords1 = new google.maps.LatLng(38.457131, -122.716730);
	var destCoords2 = new google.maps.LatLng(38.454082, -122.672098);
	var destCoords3 = new google.maps.LatLng(38.438048, -122.721569);

	
	// define a second marker variable globally for destination point
	var destMarker;
	var destMarker2;

	
	// first function does initial creation of Google Map centered at 0,0
	function createMap() {
		// set latitude and longitude coordinates using Google Map's LatLng() method
		var mapCoords = new google.maps.LatLng(38.485137, -122.741527);

		// define a property list of settings for the Google Map we are about to create
		var mapOptions = {
			zoom: 13,
			center: mapCoords,
			disableDefaultUI: true,
			styles:[{"elementType":"labels.text","stylers":[{"visibility":"on"}]},{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"color":"#f5f5f2"},{"visibility":"on"}]},{"featureType":"administrative","stylers":[{"visibility":"on"}]},{"featureType":"transit","stylers":[{"visibility":"on"}]},{"featureType":"poi.attraction","stylers":[{"visibility":"off"}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"color":"#ffffff"},{"visibility":"on"}]},{"featureType":"poi.business","stylers":[{"visibility":"off"}]},{"featureType":"poi.medical","stylers":[{"visibility":"off"}]},{"featureType":"poi.place_of_worship","stylers":[{"visibility":"off"}]},{"featureType":"poi.school","stylers":[{"visibility":"off"}]},{"featureType":"poi.sports_complex","stylers":[{"visibility":"off"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#ffffff"},{"visibility":"simplified"}]},{"featureType":"road.arterial","stylers":[{"visibility":"simplified"},{"color":"#ffffff"}]},{"featureType":"road.highway","elementType":"labels.icon","stylers":[{"color":"#ffffff"},{"visibility":"off"}]},{"featureType":"road.highway","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","stylers":[{"color":"#ffffff"}]},{"featureType":"road.local","stylers":[{"color":"#ffffff"}]},{"featureType":"poi.park","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"water","stylers":[{"color":"#71c8d4"}]},{"featureType":"landscape","stylers":[{"color":"#e5e8e7"}]},{"featureType":"poi.park","stylers":[{"color":"#8ba129"}]},{"featureType":"road","stylers":[{"color":"#ffffff"}]},{"featureType":"poi.sports_complex","elementType":"geometry","stylers":[{"color":"#c7c7c7"},{"visibility":"off"}]},{"featureType":"water","stylers":[{"color":"#a0d3d3"}]},{"featureType":"poi.park","stylers":[{"color":"#91b65d"}]},{"featureType":"poi.park","stylers":[{"gamma":1.51}]},{"featureType":"road.local","stylers":[{"visibility":"off"}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"poi.government","elementType":"geometry","stylers":[{"visibility":"off"}]},{"featureType":"landscape","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"visibility":"simplified"}]},{"featureType":"road.local","stylers":[{"visibility":"simplified"}]},{"featureType":"road"},{"featureType":"road"},{},{"featureType":"road.highway"}]
		};

		// use Google's Map() method to create a new map object inside the targeted HTML element
		map1 = new google.maps.Map(document.getElementById("map-container"), mapOptions);
		
		
	}

	// create a marker at the destination point
	function drawDestination(destination, icon, title)
	{	
		console.log(title);
		if (title == "Ike's Place")
		{
			var contentString = '<div id="content">'+
	        '<div id="siteNotice">'+
	        '</div>'+
	        '<h1 id="firstHeading" class="firstHeading">Ike\'s Place</h1>'+
	        '<div id="bodyContent">'+
	        '<p>Casual, bustling chain serving a menu of creative sandwiches, including vegan options.</p>'+
	        '</div>'+
	        '</div>';

	        var infowindow = new google.maps.InfoWindow({
	          content: contentString
	        });

			destMarker = new google.maps.Marker({
				position: destination,
				map: map1,
				title: title,
				icon: icon,
				animation: google.maps.Animation.DROP
			});
			destMarker.addListener('click', function() {
	          infowindow.open(map1, destMarker);
	        });
		}
		else if (title == "Hikuni Sushi")
		{

			destMarker2 = new google.maps.Marker({
				position: destination,
				map: map1,
				title: title,
				icon: icon,
				animation: google.maps.Animation.DROP
			});
			destMarker2.addListener('click', toggleBounce);

		}
		else if ("A'Roma Roasters")
		{
			destMarker3 = new google.maps.Marker({
				position: destination,
				map: map1,
				title: title,
				icon: icon,
				animation: google.maps.Animation.DROP,
				draggable: true
			});
		}
		 
	}

	function toggleBounce() 
	{
		if (destMarker2.getAnimation() !== null) 
		{
			destMarker2.setAnimation(null);
		} 
		else 
		{
			destMarker2.setAnimation(google.maps.Animation.BOUNCE);
		}
	}
	// second function creates or updates marker location to specific geoloc
	function drawMarker(yourPosition) 
	{
		// set latitude and longitude coordinates using Google Map's LatLng() method
		var markerCoords = new google.maps.LatLng(yourPosition.coords.latitude, yourPosition.coords.longitude);
		
		if (marker1) {
			// marker1 already defined, so just update its lat + long
			marker1.setPosition(markerCoords);
		} else {
			// first time called so create marker
			marker1 = new google.maps.Marker({
				position: markerCoords,
				map: map1,
				title:"You are here!",
				icon: 'home.png',
				animation: google.maps.Animation.DROP,
				content: "test"

			});		

		}
		
		if (line1) {
			line1.setPath( [markerCoords, destCoords1] );
		} else {
			// first time so create polyline
			line1 = new google.maps.Polyline({
				path: [markerCoords, destCoords1],
				geodesic: true,
				strokeColor: '#FF0000',
				strokeOpacity: 0.9,
				strokeWeight: 2
			});
			line1.setMap(map1);
		}

		if (line2) {
			line2.setPath( [markerCoords, destCoords2] );
		} else {
			// first time so create polyline
			line1 = new google.maps.Polyline({
				path: [markerCoords, destCoords2],
				geodesic: true,
				strokeColor: '#FF0000',
				strokeOpacity: 0.9,
				strokeWeight: 2
			});
			line1.setMap(map1);
		}

		if (line3) {
			line3.setPath( [markerCoords, destCoords3] );
		} else {
			// first time so create polyline
			line3 = new google.maps.Polyline({
				path: [markerCoords, destCoords3],
				geodesic: true,
				strokeColor: '#FF0000',
				strokeOpacity: 0.9,
				strokeWeight: 2
			});
			line3.setMap(map1);
		}
		// update center of map to match marker location
		//map1.setCenter(markerCoords);
		
		// calculate the distance between markerCoords and destCoords
		var dist = Math.round((google.maps.geometry.spherical.computeDistanceBetween (markerCoords, destCoords1) * 0.0006213711) * 100) / 100
		document.getElementById('distance-display').innerHTML = dist;
		
		// once we draw marker, set timer to call userLocation() later to update loc		
		//setTimeout( userLocation, 500);
	}
	
	// third function gets user geoloc, then calls drawMarker()
	function userLocation() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition( drawMarker );
		}
	}

	createMap();
	setTimeout(function()
	{ 
		drawDestination(destCoords1, "sandwich.png", "Ike's Place");
		drawDestination(destCoords2, "sushi.png", "Hikuni Sushi");
		drawDestination(destCoords3, "coffee.png", "A'Roma Roasters");

	}, 2000);
	userLocation();

	</script>
</body>
</html>